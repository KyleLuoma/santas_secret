//$("#test").html();

//retrieveUserPools(1);

/**
 * Populates element with gift_pool_table id with table generating HTML containing
 * gift pools that userId is a member of.
 * @param userId user Id number associated with gift pools to appear in table
 * @returns {string}
 */
function retrieveUserPools(userId) {

  var result = "";
  
  $.ajax({
    //url: "/echo/json/",
      url: 'gift_pool/for_user',
    type: 'GET',
    data: {
      userId: userId
    },
    dataType: 'json',
    success: function(json) {
      var table_string = "<table class='table'><tr></tr><th colspan=2>Title:</th><th colspan=2>Description:</th></tr>\n";
      var poolArray = [];

      for (var i = 0; i < json.length; i++) {
        poolArray.push(json[i].id);
        table_string += "<tr><td colspan=2>" + json[i].poolTitle + "</td><td colspan=2>" + json[i].poolDescription + "</td></tr>\n";
        table_string += 
          "  <tr>\n" +
          "    <td id='users_in_pool" + json[i].id + "'></td>\n" +
          "    <td id='items_in_pool" + json[i].id + "'></td>\n" +
          "    <td id='gifts_purchased_in_pool" + json[i].id + "'>\n" +
          "    <td><a href='\\pool_view?poolId=" + json[i].id + "'>VIEW</a></td>\n" +
          "  </tr>";
      }
      table_string = table_string + "\n</table>";
      $("#dump").html(JSON.stringify(json));
      $("#gift_pool_table").html(table_string);
      populatePoolMetaData(poolArray, userId);
    },
    error: function() {
      console.log("Oops, something went wrong when trying to load gift pool data.");
      document.getElementById("gift_pool_table").innerHTML = "Unable to load gift pool data.";
    }
  });
  return result;
}

/**
 * retrieveUeerPools function calls this function after success. populatePoolMetaData retrieves
 * a meta data object from the application and populates table cells autogenerated by retrieveUserPools
 * to display meta data relevant to each of a user's pools.
 * @param poolIds a list of pool ids that the user associated with userId participates in
 * @param userId userId associated with logged in user.
 */
function populatePoolMetaData(poolIds, userId) {

  $.ajax({
    //url: "/echo/json/",
    url: 'gift_pool/user_pool_meta_data',
    type: 'GET',
    data: {
      userId: userId
      //json: metaString
    },
    dataType: 'json',
    success: function(json) {
      for(var i = 0; i < json.length; i++) {
          $("#users_in_pool" + json[i].poolId).html(json[i].numUsers + " users in pool");
          $("#items_in_pool" + json[i].poolId).html(json[i].numItems + " of your items in pool");
          $("#gifts_purchased_in_pool" + json[i].poolId).html(json[i].numGiftsPurchased + " gifts purchased by you");
        }
    },
    error: function() {
      console.log("Oops, something went wrong when trying to load pool meata data.");
      $("#errormsg").html("Error in populatePoolMetaData ");
    }
  });
}
